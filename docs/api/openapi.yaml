openapi: 3.0.3
info:
  title: Forex Trading Helper API
  description: |
    API untuk aplikasi Forex Trading Helper yang menyediakan fitur:
    - Lot Calculator: Menghitung ukuran posisi trading berdasarkan risk management
    - Trade History: Mencatat dan mengelola riwayat trading
    - Reports & Analytics: Menganalisis performa trading
    - User Management: Manajemen user dan autentikasi
  version: 1.0.0
  contact:
    name: API Support
    email: support@forexhelper.com

servers:
  - url: http://localhost:3000
    description: Development server
  - url: https://api.forexhelper.com
    description: Production server

tags:
  - name: Authentication
    description: Endpoints untuk autentikasi dan manajemen user
  - name: Lot Calculator
    description: Endpoints untuk kalkulator ukuran posisi trading
  - name: Trade History
    description: Endpoints untuk mengelola riwayat trading
  - name: Reports
    description: Endpoints untuk laporan dan analisis trading

paths:
  /api/auth/register:
    post:
      tags:
        - Authentication
      summary: Register new user
      description: Mendaftarkan user baru ke sistem
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            example:
              email: "user@example.com"
              password: "SecurePass123"
      responses:
        '201':
          description: User berhasil didaftarkan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Request tidak valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Email sudah terdaftar
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: Login user
      description: Autentikasi user dan mendapatkan JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              email: "user@example.com"
              password: "SecurePass123"
      responses:
        '200':
          description: Login berhasil
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Email atau password salah
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/me:
    get:
      tags:
        - Authentication
      summary: Get current user
      description: Mendapatkan informasi user yang sedang login
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Informasi user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/profile:
    put:
      tags:
        - Authentication
      summary: Update user profile
      description: Mengupdate profil user
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfileRequest'
      responses:
        '200':
          description: Profil berhasil diupdate
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/change-password:
    post:
      tags:
        - Authentication
      summary: Change password
      description: Mengubah password user
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
      responses:
        '200':
          description: Password berhasil diubah
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password changed successfully"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/lot-calculator/calculate:
    post:
      tags:
        - Lot Calculator
      summary: Calculate position size
      description: Menghitung ukuran posisi trading berdasarkan risk management
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CalculatePositionSizeRequest'
            example:
              accountBalance: 10000
              accountCurrency: "USD"
              riskPercentage: 2
              stopLoss: 50
              stopLossUnit: "pips"
              currencyPair: "EURUSD"
              currentPrice: null
      responses:
        '200':
          description: Hasil perhitungan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PositionSizeCalculationResponse'
        '400':
          description: Request tidak valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/lot-calculator/pairs:
    get:
      tags:
        - Lot Calculator
      summary: Get currency pairs
      description: Mendapatkan daftar currency pairs yang tersedia
      parameters:
        - name: type
          in: query
          description: Filter berdasarkan tipe pair
          required: false
          schema:
            type: string
            enum: [major, cross, metal]
      responses:
        '200':
          description: Daftar currency pairs
          content:
            application/json:
              schema:
                type: object
                properties:
                  pairs:
                    type: array
                    items:
                      $ref: '#/components/schemas/CurrencyPair'

  /api/lot-calculator/pip-value:
    get:
      tags:
        - Lot Calculator
      summary: Get pip value
      description: Menghitung nilai pip per lot untuk currency pair
      parameters:
        - name: currencyPair
          in: query
          required: true
          schema:
            type: string
            example: "EURUSD"
        - name: accountCurrency
          in: query
          required: true
          schema:
            type: string
            example: "USD"
        - name: currentPrice
          in: query
          required: false
          schema:
            type: number
            example: 1.1000
      responses:
        '200':
          description: Nilai pip per lot
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PipValueResponse'
        '400':
          description: Request tidak valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/trades:
    get:
      tags:
        - Trade History
      summary: Get all trades
      description: Mendapatkan daftar semua trades user
      security:
        - bearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [OPEN, WIN, LOSS, BREAK_EVEN]
        - name: pair
          in: query
          schema:
            type: string
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
        - name: page
          in: query
          schema:
            type: integer
        - name: pageSize
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Daftar trades
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TradeListResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Trade History
      summary: Create new trade
      description: Membuat trade baru
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTradeRequest'
      responses:
        '201':
          description: Trade berhasil dibuat
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TradeResponse'
        '400':
          description: Request tidak valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/trades/{id}:
    get:
      tags:
        - Trade History
      summary: Get trade by ID
      description: Mendapatkan detail trade berdasarkan ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Detail trade
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TradeResponse'
        '404':
          description: Trade tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Trade History
      summary: Update trade
      description: Mengupdate trade yang sudah ada
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTradeRequest'
      responses:
        '200':
          description: Trade berhasil diupdate
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TradeResponse'
        '400':
          description: Request tidak valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Trade tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Trade History
      summary: Delete trade
      description: Menghapus trade
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Trade berhasil dihapus
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Trade tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/reports/metrics:
    get:
      tags:
        - Reports
      summary: Get performance metrics
      description: Mendapatkan metrik performa trading
      security:
        - bearerAuth: []
      parameters:
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Metrik performa
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetricsResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/reports/generate:
    post:
      tags:
        - Reports
      summary: Generate trading report
      description: Membuat laporan trading untuk periode tertentu
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateReportRequest'
      responses:
        '201':
          description: Laporan berhasil dibuat
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportResponse'
        '400':
          description: Request tidak valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/reports/{id}:
    get:
      tags:
        - Reports
      summary: Get report by ID
      description: Mendapatkan detail laporan berdasarkan ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Detail laporan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportResponse'
        '404':
          description: Laporan tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token yang didapat dari endpoint /api/auth/login

  schemas:
    RegisterRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "user@example.com"
        password:
          type: string
          format: password
          minLength: 8
          example: "SecurePass123"

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "user@example.com"
        password:
          type: string
          format: password
          example: "SecurePass123"

    AuthResponse:
      type: object
      properties:
        user:
          type: object
          properties:
            id:
              type: string
            email:
              type: string
        token:
          type: string
          description: JWT token untuk autentikasi

    UserResponse:
      type: object
      properties:
        user:
          type: object
          properties:
            id:
              type: string
            email:
              type: string
            profile:
              $ref: '#/components/schemas/UserProfile'

    UpdateProfileRequest:
      type: object
      properties:
        firstName:
          type: string
          nullable: true
        lastName:
          type: string
          nullable: true
        displayName:
          type: string
          nullable: true
        avatar:
          type: string
          nullable: true

    ChangePasswordRequest:
      type: object
      required:
        - currentPassword
        - newPassword
      properties:
        currentPassword:
          type: string
          format: password
        newPassword:
          type: string
          format: password
          minLength: 8

    UserProfile:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        firstName:
          type: string
          nullable: true
        lastName:
          type: string
          nullable: true
        displayName:
          type: string
          nullable: true
        avatar:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    UserProfileResponse:
      type: object
      properties:
        profile:
          $ref: '#/components/schemas/UserProfile'

    CalculatePositionSizeRequest:
      type: object
      required:
        - accountBalance
        - accountCurrency
        - riskPercentage
        - stopLoss
        - stopLossUnit
        - currencyPair
      properties:
        accountBalance:
          type: number
          minimum: 0
          example: 10000
        accountCurrency:
          type: string
          enum: [USD, EUR, JPY, GBP, AUD, CAD, CHF, NZD, IDR]
          example: "USD"
        riskPercentage:
          type: number
          minimum: 0
          maximum: 100
          example: 2
        stopLoss:
          type: number
          minimum: 0
          example: 50
        stopLossUnit:
          type: string
          enum: [pips, points]
          example: "pips"
        currencyPair:
          type: string
          example: "EURUSD"
        currentPrice:
          type: number
          nullable: true
          description: Required for USD/XXX pairs
          example: null

    PositionSizeCalculationResponse:
      type: object
      properties:
        id:
          type: string
        lotSize:
          type: number
          example: 0.4
        positionSize:
          type: number
          example: 40000
        riskAmount:
          type: number
          example: 200
        accountBalance:
          type: number
          example: 10000
        accountCurrency:
          type: string
          example: "USD"
        riskPercentage:
          type: number
          example: 2
        currencyPair:
          type: string
          example: "EURUSD"
        stopLoss:
          type: number
          example: 50
        stopLossUnit:
          type: string
          example: "pips"
        pipValue:
          type: number
          example: 10
        pipValueCurrency:
          type: string
          example: "USD"
        calculatedAt:
          type: string
          format: date-time

    CurrencyPair:
      type: object
      properties:
        pair:
          type: string
          example: "EURUSD"
        baseCurrency:
          type: string
          example: "EUR"
        quoteCurrency:
          type: string
          example: "USD"
        type:
          type: string
          enum: [major, cross, metal]
          example: "major"

    PipValueResponse:
      type: object
      properties:
        pipValue:
          type: number
          example: 10
        currency:
          type: string
          example: "USD"

    CreateTradeRequest:
      type: object
      required:
        - pair
        - direction
        - entryPrice
        - lotSize
        - riskAmount
        - entryTime
      properties:
        pair:
          type: string
          example: "EURUSD"
        direction:
          type: string
          enum: [BUY, SELL]
          example: "BUY"
        entryPrice:
          type: number
          minimum: 0
          example: 1.1000
        exitPrice:
          type: number
          nullable: true
          minimum: 0
        lotSize:
          type: number
          minimum: 0
          example: 0.1
        stopLoss:
          type: number
          nullable: true
          minimum: 0
        takeProfit:
          type: number
          nullable: true
          minimum: 0
        entryTime:
          type: string
          format: date-time
        exitTime:
          type: string
          nullable: true
          format: date-time
        riskAmount:
          type: number
          minimum: 0
          example: 100
        notes:
          type: string
          nullable: true

    UpdateTradeRequest:
      type: object
      properties:
        exitPrice:
          type: number
          minimum: 0
        exitTime:
          type: string
          format: date-time
        notes:
          type: string
          nullable: true

    TradeResponse:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        pair:
          type: string
        direction:
          type: string
          enum: [BUY, SELL]
        entryPrice:
          type: number
        exitPrice:
          type: number
          nullable: true
        lotSize:
          type: number
        stopLoss:
          type: number
          nullable: true
        takeProfit:
          type: number
          nullable: true
        pips:
          type: number
          nullable: true
        points:
          type: number
          nullable: true
        profitLoss:
          type: number
          nullable: true
        profitLossCurrency:
          type: string
          nullable: true
        riskAmount:
          type: number
        riskRewardRatio:
          type: number
          nullable: true
        status:
          type: string
          enum: [OPEN, WIN, LOSS, BREAK_EVEN]
        entryTime:
          type: string
          format: date-time
        exitTime:
          type: string
          nullable: true
          format: date-time
        notes:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TradeListResponse:
      type: object
      properties:
        trades:
          type: array
          items:
            $ref: '#/components/schemas/TradeResponse'
        total:
          type: integer
        page:
          type: integer
        pageSize:
          type: integer
        totalPages:
          type: integer

    GenerateReportRequest:
      type: object
      required:
        - startDate
        - endDate
      properties:
        startDate:
          type: string
          format: date
          example: "2024-01-01"
        endDate:
          type: string
          format: date
          example: "2024-12-31"

    MetricsResponse:
      type: object
      properties:
        metrics:
          $ref: '#/components/schemas/PerformanceMetrics'

    PerformanceMetrics:
      type: object
      properties:
        totalTrades:
          type: integer
        winningTrades:
          type: integer
        losingTrades:
          type: integer
        winRate:
          type: number
          example: 65.5
        totalProfitLoss:
          type: number
        totalProfitLossCurrency:
          type: string
        averageWin:
          type: number
        averageLoss:
          type: number
        profitFactor:
          type: number
        expectancy:
          type: number
        maximumDrawdown:
          type: number
        maximumDrawdownCurrency:
          type: string
        averageRiskRewardRatio:
          type: number
        bestTrade:
          type: number
          nullable: true
        worstTrade:
          type: number
          nullable: true
        longestWinningStreak:
          type: integer
        longestLosingStreak:
          type: integer

    ReportResponse:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        metrics:
          $ref: '#/components/schemas/PerformanceMetrics'
        createdAt:
          type: string
          format: date-time

    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            message:
              type: string
            code:
              type: string
            details:
              type: object

